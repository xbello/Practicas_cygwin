<html>
 <head>
  <title>Bioinformatics for dummies</title>
  <meta charset="utf-8" />
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
       padding: 10%;
    }
  </style>
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
 </head>
 <body>
<h1 id="introduccion">Introducción</h1>
<div class="toc">
<ul>
<li><a href="#introduccion">Introducción</a></li>
<li><a href="#antes-de-nada">Antes de nada...</a><ul>
<li><a href="#los-de-windows">Los de Windows</a></li>
<li><a href="#los-de-maclinux">Los de Mac/Linux</a></li>
</ul>
</li>
<li><a href="#procesamiento-de-textos">Procesamiento de textos</a><ul>
<li><a href="#ojear-un-fichero">Ojear un fichero</a></li>
<li><a href="#repeticion-de-ultimo-comando">Repetición de último comando</a></li>
<li><a href="#contaje-de-lineas">Contaje de líneas</a></li>
<li><a href="#impresion-de-la-segunda-columna">Impresión de la segunda columna</a></li>
<li><a href="#buscar-una-palabra">Buscar una palabra</a></li>
<li><a href="#buscar-un-patron">Buscar un patrón</a></li>
<li><a href="#cruzar-input-con-fichero-de-patrones-en-una-columna">Cruzar input con fichero de patrones en una columna</a></li>
<li><a href="#eliminar-las-tres-primeras-columnas">Eliminar las tres primeras columnas</a></li>
</ul>
</li>
<li><a href="#agrupacion-de-ordenes">Agrupación de órdenes</a><ul>
<li><a href="#redireccion">Redirección</a></li>
<li><a href="#concatenacion">Concatenación</a></li>
<li><a href="#concatenacion-multiple">Concatenación múltiple</a></li>
</ul>
</li>
<li><a href="#manejo-de-ficheros-en-bloque">Manejo de ficheros en bloque</a><ul>
<li><a href="#listar-todos-los-ficheros-con-extension-txt">Listar todos los ficheros con extensión .txt</a></li>
<li><a href="#copiar-todos-los-ficheros-txt-cambiando-su-extension-a-tab">Copiar todos los ficheros .txt cambiando su extensión a .tab</a></li>
<li><a href="#eliminar-todos-los-ficheros-de-extension-tab">Eliminar todos los ficheros de extensión .tab</a></li>
</ul>
</li>
<li><a href="#ejemplo-practico-1-deteccion-de-variantes-comunes">Ejemplo práctico 1: Detección de variantes comunes</a><ul>
<li><a href="#extraccion-y-busqueda-en-pasos-separados">Extracción y búsqueda en pasos separados</a></li>
<li><a href="#extraccion-y-busqueda-combinadas">Extracción y búsqueda combinadas</a></li>
</ul>
</li>
<li><a href="#ejemplo-practico-2-filtrar-variantes-con-un-listado-de-genes">Ejemplo práctico 2: Filtrar variantes con un listado de genes</a><ul>
<li><a href="#busqueda-de-1-gen">Búsqueda de 1 gen</a></li>
<li><a href="#lectura-de-un-fichero-linea-a-linea">Lectura de un fichero línea a línea</a></li>
<li><a href="#busqueda-de-varios-genes">Búsqueda de varios genes</a></li>
</ul>
</li>
<li><a href="#auto-evaluacion">Auto-evaluación</a><ul>
<li><a href="#ejercicio-1">Ejercicio 1</a></li>
<li><a href="#ejercicio-2">Ejercicio 2</a></li>
</ul>
</li>
</ul>
</div>
<pre><code>terminal, shell, command line
(tab key)
cp, mv, rm
mkdir, cd, . .. *
cat, head, tail, less, more
sort, uniq, wc
for, foreach
cut
grep
awk
sed
perl
</code></pre>
<h1 id="antes-de-nada">Antes de nada...</h1>
<h2 id="los-de-windows">Los de Windows</h2>
<p>Cygwin instalado.</p>
<p>Abrir un terminal.</p>
<pre><code>cd /cygdrive/c/
mkdir datafordummies
cd datafordummies
</code></pre>
<p>Copiar el contenido de la carpeta 'data' del archivo comprimido del curso a esta nueva carpeta C:\datafordummies</p>
<h2 id="los-de-maclinux">Los de Mac/Linux</h2>
<p>Abrir un terminal.</p>
<pre><code>cd Desktop
mkdir datafordummies
cd datafordummies
</code></pre>
<p>Copiar el contenido de la carpeta 'data' del archivo comprimido del curso a esta nueva carpeta ~/Desktop/datafordummies</p>
<h1 id="procesamiento-de-textos">Procesamiento de textos</h1>
<h2 id="ojear-un-fichero">Ojear un fichero</h2>
<pre><code>cat input1.txt
head input1.txt
head -n2 input1.txt
tail input1.txt
tail -n10 input1.txt
less input1.txt
</code></pre>
<h2 id="repeticion-de-ultimo-comando">Repetición de último comando</h2>
<pre><code>!head
</code></pre>
<h2 id="contaje-de-lineas">Contaje de líneas</h2>
<pre><code>wc -l input1.txt
</code></pre>
<h2 id="impresion-de-la-segunda-columna">Impresión de la segunda columna</h2>
<pre><code>awk '{print $2}' input1.txt
cut -f2 input1.txt
</code></pre>
<p>E.g. ver la lista de genes del archivo <code>input2.txt</code>, que están en la columna 7:</p>
<pre><code>awk '{print $7}' input2.txt
cut -f7 input2.txt
</code></pre>
<h2 id="buscar-una-palabra">Buscar una palabra</h2>
<pre><code>grep "palabra" input1.txt
</code></pre>
<p>E.g. buscar la palabra GGA en el archivo input1.txt:</p>
<pre><code>grep "GGA" input1.txt
</code></pre>
<p>E.g. ver todas las variantes del gen CFTR del archivo input2.txt:</p>
<pre><code>grep "CFTR" input2.txt
</code></pre>
<p>E.g. ver todas las variantes del gen PKD1 del archivo input2.txt:</p>
<pre><code>grep "PKD1" input2.txt
</code></pre>
<h2 id="buscar-un-patron">Buscar un patrón</h2>
<pre><code>grep -P '\bpalabra\b' input1.txt
</code></pre>
<p>E.g. ver todas las variantes del cromosoma 1, pero no del cromosoma 1?, en el archivo input1.txt</p>
<div class="alert alert-danger" role="alert">Con este comando obtendremos las líneas que contengan un carácter '1' (no es lo que buscamos).<br />
<pre><code>grep -P '1' input1.txt</code></pre>
</div>

<div class="alert alert-danger" role="alert">Con este comando obtendremos las líneas que empiecen por un carácter '1' (casi es lo que buscamos).<br />
<pre><code>grep -P '^1' input1.txt</code></pre>
</div>

<div class="alert alert-success" role="alert">Con este comando obtendremos las líneas que empiecen por un carácter '1' y una tabulación (ésta es la forma correcta).<br />
<pre><code>grep -P '^1\t' input1.txt</code></pre>
</div>

<p>E.g. ver todas las variantes del gen PKD1 del archivo input2.txt:</p>
<pre><code>grep -P "\bPKD1\b" input2.txt
</code></pre>
<p>http://www.regular-expressions.info/</p>
<h2 id="cruzar-input-con-fichero-de-patrones-en-una-columna">Cruzar input con fichero de patrones en una columna</h2>
<p>(dos2unix genes.txt puede ser necesario)</p>
<pre><code>grep -f genes.txt input2.txt
</code></pre>
<h2 id="eliminar-las-tres-primeras-columnas">Eliminar las tres primeras columnas</h2>
<pre><code>cut -f 4- input1.txt
cut -f1-3 --complement input1.txt
awk '{for (i=4; i&lt;NF; i++) printf $i " "; print $NF}' input1.txt
awk 'OFS="\t"{for (i=4; i&lt;NF; i++) printf $i " "; print $NF}' input1.txt
</code></pre>
<div class="alert alert-info" role="alert">

<ul>
 <li>OFS es una palabra especial (<em>builtin variable</em>) de AWK, significa "Output Field Separator".</li>
 <li>NF es una palabra especial (<em>builtin variable</em>) de AWK, significa "Number of Fields".</li>
 <li><a href="http://www.chemie.fu-berlin.de/chemnet/use/info/gawk/gawk_11.html" target="_new">Lista de builtins AWK<span class="glyphicon glyphicon-link"></span></a></li>
</ul>

</div>

<h1 id="agrupacion-de-ordenes">Agrupación de órdenes</h1>
<h2 id="redireccion">Redirección</h2>
<pre><code>cat input1.txt &gt; output1.txt
cat input1.txt input2.txt &gt; output1and2.txt
</code></pre>
<h2 id="concatenacion">Concatenación</h2>
<pre><code>cat input1.txt | wc -l
cat output1.txt | wc -l
cat output1and2.txt | wc -l
</code></pre>
<h2 id="concatenacion-multiple">Concatenación múltiple</h2>
<pre><code>cat input1.txt | wc -l
</code></pre>
<h1 id="manejo-de-ficheros-en-bloque">Manejo de ficheros en bloque</h1>
<h2 id="listar-todos-los-ficheros-con-extension-txt">Listar todos los ficheros con extensión .txt</h2>
<pre><code>ls *.txt
for file in *.txt; do echo $file; done
ls -1 *.txt
</code></pre>
<h2 id="copiar-todos-los-ficheros-txt-cambiando-su-extension-a-tab">Copiar todos los ficheros .txt cambiando su extensión a .tab</h2>
<pre><code>for file in *.txt; do cp $file ${file/.txt/.tab}; done
</code></pre>
<h2 id="eliminar-todos-los-ficheros-de-extension-tab">Eliminar todos los ficheros de extensión .tab</h2>
<pre><code>rm *.tab
</code></pre>
<h1 id="ejemplo-practico-1-deteccion-de-variantes-comunes">Ejemplo práctico 1: Detección de variantes comunes</h1>
<h2 id="extraccion-y-busqueda-en-pasos-separados">Extracción y búsqueda en pasos separados</h2>
<pre><code>cut -f 1-5 annotation.GATK.txt &gt; variantes.GATK.txt
grep -f variantes.GATK.txt annotation.LIFE.txt &gt; variantes.compartidas.txt
</code></pre>
<h2 id="extraccion-y-busqueda-combinadas">Extracción y búsqueda combinadas</h2>
<pre><code>grep -f &lt;(cut -f 1-5 annotation.LIFE.txt) annotation.GATK.txt &gt; variantes.compartidas.2.txt
</code></pre>
<h1 id="ejemplo-practico-2-filtrar-variantes-con-un-listado-de-genes">Ejemplo práctico 2: Filtrar variantes con un listado de genes</h1>
<h2 id="busqueda-de-1-gen">Búsqueda de 1 gen</h2>
<p>(el carácter '\y' en awk equivale a '\b' en la mayoría de programas)</p>
<pre><code>awk '$7 ~ /\yPKD1\y/' input2.txt
perl -lane '$F[6] =~ /\bPKD1\b/ and print' input2.txt
</code></pre>
<h2 id="lectura-de-un-fichero-linea-a-linea">Lectura de un fichero línea a línea</h2>
<pre><code>while read -r line; do
echo "Texto encontrado: $line"
done &lt; genes.txt
</code></pre>
<h2 id="busqueda-de-varios-genes">Búsqueda de varios genes</h2>
<pre><code>while read -r line; do
awk -v gen="\\\\y$line\\\\y" '$7 ~ gen' input2.txt
done &lt; genes.txt
</code></pre>
<h1 id="auto-evaluacion">Auto-evaluación</h1>
<h2 id="ejercicio-1">Ejercicio 1</h2>
<p>Tenemos un archivo con los posibles alelos para cada individuo, con líneas de esta forma:</p>
<pre><code>--- rs149529999 60479 C T 1 0 0 1 0 0 etc.
</code></pre>
<ul>
<li>Primera columna es un identificador.</li>
<li>Segunda columna es un rs.</li>
<li>Tercera columna es una posición cromosómica.</li>
<li>Cuarta y quinta columnas son los alelos referencia y variante.</li>
<li>Cada grupo de tres números siguientes es la posibilidad de un individuo para ser homocigoto para el alelo de referencia, para el variante y ser heterocigoto respectivamente.</li>
</ul>
<p><strong>Intentar</strong>:</p>
<ul>
<li>Obtener sólo las cinco primeras columnas en pantalla.</li>
</ul>
<div class="btn-group" role="group">
<a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_11-pista_1">Pista 1</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_11-pista_2">Pista 2</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_11-solucion">Solución</a>
</div>

<div class="collapse" id="ex_11-pista_1"><div class="well">Se utiliza el comando <code>cut</code>. Las opciones se pueden comprobar con <code>man cut</code>.</div></div>

<div class="collapse" id="ex_11-pista_2"><div class="well">Las columnas están divididas con espacios. Cut define los campos con el flag <code>cut -d " "</code>.</div></div>

<div class="collapse" id="ex_11-solucion"><div class="well"><code>cut -d " " -f 1-5 Ejercicio_1.txt</code>.</div></div>

<ul>
<li>De este listado de 5 columnas, obtener sólo las variantes SNP, descartando los indels.</li>
</ul>
<div class="btn-group" role="group">
<a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_12-pista_1">Pista 1</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_12-pista_2">Pista 2</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_12_solucion">Solución</a>
</div>

<div class="collapse" id="ex_12-pista_1"><div class="well">Para comprobar el valor en cada columna se puede utilizar <code>awk</code></div></div>

<div class="collapse" id="ex_12-pista_2"><div class="well">Los indels pueden identificarse porque uno de los dos alelos es igual a <code>-</code></div></div>

<div class="collapse" id="ex_12_solucion"><div class="well"><code>cut -d " " -f 1-5 Ejercicio_1.txt | awk '{if ($4 != "-" && $5 != "-") print }'</code></div></div>

<ul>
<li>Y si quisiésemos capturar sólo los indels?</li>
</ul>
<div class="btn-group" role="group">
<a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_13_solucion">Solución</a>
</div>

<div class="collapse" id="ex_13_solucion"><div class="well"><code>cut -d " " -f 1-5 Ejercicio_1.txt | awk '{if ($4 == "-" || $5 == "-") print }'</code></div></div>

<ul>
<li>Y si quisiésemos capturar los SNPs con una búsqueda de patrón?</li>
</ul>
<div class="btn-group" role="group">
<a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_13_solucion">Solución</a>
</div>

<div class="collapse" id="ex_13_solucion"><div class="well"><code>cut -d " " -f 1-5 Ejercicio_1.txt | grep -v " -"</code></div></div>

<h2 id="ejercicio-2">Ejercicio 2</h2>
<p>Tenemos un archivo procedente de una anotación con Annovar, con líneas de esta forma:</p>
<pre><code>ljb23_all   0.01,0.99,D,0.321,B,0.09,B,0.000,1.0,D,1.000,1.000,D,0.205,0.499,N,-0.09,0.401,T,-0.865,0.284,T,0.153,T,5.98,2.837,20.437   1   218520000   218520000   G   C
</code></pre>
<ul>
<li>La primera columna indica la tabla de anotación.</li>
<li>La segunda columna son las anotaciones separadas por comas.</li>
<li>Las siguientes cinco columnas son la posición de la variante (cromosoma, inicio, fin, referencia, variante).</li>
</ul>
<p><strong>Intentar</strong>:</p>
<ul>
<li>Transformar las comas de la segunda columna en tabulados, para que un programa como Excel pueda leer mejor el archivo.</li>
</ul>
<div class="btn-group" role="group">
<a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_21-pista_1">Pista 1</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_21-pista_2">Pista 2</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_21-solucion">Solución</a>
</div>

<div class="collapse" id="ex_21-pista_1"><div class="well">El comando más recomendable es <code>sed</code>.</div></div>

<div class="collapse" id="ex_21-pista_2"><div class="well">El carácter especial TABULADOR se marca como <code>\t</code>.</div></div>

<div class="collapse" id="ex_21-solucion"><div class="well"><code>sed 's/,/\t/g' Ejercicio_2.txt</code></div></div>

<ul>
<li>Ordenar el archivo por cromosoma.</li>
</ul>
<div class="btn-group" role="group">
<a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_22-pista_1">Pista 1</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_22-pista_2">Pista 2</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_22-pista_3">Pista 3</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_22-solucion">Solución</a>
</div>

<div class="collapse" id="ex_22-pista_1"><div class="well">El comando más recomendable es <code>sort</code>.</div></div>

<div class="collapse" id="ex_22-pista_2"><div class="well">Para especificar un campo se indica <code>-kX</code>, siendo X el número del campo.</div></div>

<div class="collapse" id="ex_22-pista_2"><div class="well">Para ordenar un campo numéricamente se indica <code>-kXn</code>, siendo X el número del campo.</div></div>

<div class="collapse" id="ex_22-solucion"><div class="well"><code>sort -k3,3n Ejercicio_2.txt</code></div></div>

<ul>
<li>Los dos pasos anteriores a la vez!</li>
</ul>
<p>Y guardar los resultados en un archivo "Resultados.tab"</p>
<div class="btn-group" role="group">
<a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_23-pista_1">Pista 1</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_23-pista_2">Pista 2</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_23-pista_1">Pista 1</a><a class="btn btn-primary" role="button" data-toggle="collapse" href="#ex_23-solucion">Solución</a>
</div>

<div class="collapse" id="ex_23-pista_1"><div class="well">La salida de un comando se redirige al siguiente con <code>|</code>.</div></div>

<div class="collapse" id="ex_23-pista_2"><div class="well">La salida de un comando se guarda en un fichero con <code>&gt;</code>.</div></div>

<div class="collapse" id="ex_23-solucion"><div class="well"><code>sed 's/,/\t/g' Ejercicio_2.txt | sort -k29n > Resultados.tab</code></div></div> </body>
</html>
